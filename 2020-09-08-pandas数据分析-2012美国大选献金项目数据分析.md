---
layout: post
title: pandasæ•°æ®åˆ†æ-2012ç¾å›½å¤§é€‰çŒ®é‡‘é¡¹ç›®æ•°æ®åˆ†æ
subtitle: python pandas
author: Kingtous
date: 2020-09-08 17:03:40
header-img: img/home-bg-art.jpg
catalog: True
tags:
- python
---

### éœ€æ±‚

- åŠ è½½æ•°æ®
- æŸ¥çœ‹æ•°æ®çš„åŸºæœ¬ä¿¡æ¯
- æŒ‡å®šæ•°æ®æˆªå–ï¼Œå°†å¦‚ä¸‹å­—æ®µçš„æ•°æ®è¿›è¡Œæå–ï¼Œå…¶ä»–æ•°æ®èˆå¼ƒ
  - cand_nm ï¼šå€™é€‰äººå§“å
  - contbr_nm ï¼š æèµ äººå§“å
  - contbr_st ï¼šæèµ äººæ‰€åœ¨å·
  - contbr_employer ï¼š æèµ äººæ‰€åœ¨å…¬å¸
  - contbr_occupation ï¼š æèµ äººèŒä¸š
  - contb_receipt_amt ï¼šæèµ æ•°é¢ï¼ˆç¾å…ƒï¼‰
  - contb_receipt_dt ï¼š ææ¬¾çš„æ—¥æœŸ
- å¯¹æ–°æ•°æ®è¿›è¡Œæ€»è§ˆ,æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç¼ºå¤±æ•°æ®
- ç”¨ç»Ÿè®¡å­¦æŒ‡æ ‡å¿«é€Ÿæè¿°æ•°å€¼å‹å±æ€§çš„æ¦‚è¦ã€‚
- ç©ºå€¼å¤„ç†ã€‚å¯èƒ½å› ä¸ºå¿˜è®°å¡«å†™æˆ–è€…ä¿å¯†ç­‰ç­‰åŸå› ï¼Œç›¸å…³å­—æ®µå‡ºç°äº†ç©ºå€¼ï¼Œå°†å…¶å¡«å……ä¸ºNOT PROVIDE
- å¼‚å¸¸å€¼å¤„ç†ã€‚å°†ææ¬¾é‡‘é¢<=0çš„æ•°æ®åˆ é™¤
- æ–°å»ºä¸€åˆ—ä¸ºå„ä¸ªå€™é€‰äººæ‰€åœ¨å…šæ´¾party
- æŸ¥çœ‹partyè¿™ä¸€åˆ—ä¸­æœ‰å“ªäº›ä¸åŒçš„å…ƒç´ 
- ç»Ÿè®¡partyåˆ—ä¸­å„ä¸ªå…ƒç´ å‡ºç°æ¬¡æ•°
- æŸ¥çœ‹å„ä¸ªå…šæ´¾æ”¶åˆ°çš„æ”¿æ²»çŒ®é‡‘æ€»æ•°contb_receipt_amt
- æŸ¥çœ‹å…·ä½“æ¯å¤©å„ä¸ªå…šæ´¾æ”¶åˆ°çš„æ”¿æ²»çŒ®é‡‘æ€»æ•°contb_receipt_amt
- å°†è¡¨ä¸­æ—¥æœŸæ ¼å¼è½¬æ¢ä¸º'yyyy-mm-dd'ã€‚
- æŸ¥çœ‹è€å…µ(æçŒ®è€…èŒä¸š)DISABLED VETERANä¸»è¦æ”¯æŒè°

---

#### é¢„è®¾é¡¹

```python
#æ–¹ä¾¿å¤§å®¶æ“ä½œï¼Œå°†æœˆä»½å’Œå‚é€‰äººä»¥åŠæ‰€åœ¨æ”¿å…šè¿›è¡Œå®šä¹‰ï¼š
months = {'JAN' : 1, 'FEB' : 2, 'MAR' : 3, 'APR' : 4, 'MAY' : 5, 'JUN' : 6,
          'JUL' : 7, 'AUG' : 8, 'SEP' : 9, 'OCT': 10, 'NOV': 11, 'DEC' : 12}

parties = {
  'Bachmann, Michelle': 'Republican',
  'Romney, Mitt': 'Republican',
  'Obama, Barack': 'Democrat',
  "Roemer, Charles E. 'Buddy' III": 'Reform',
  'Pawlenty, Timothy': 'Republican',
  'Johnson, Gary Earl': 'Libertarian',
  'Paul, Ron': 'Republican',
  'Santorum, Rick': 'Republican',
  'Cain, Herman': 'Republican',
  'Gingrich, Newt': 'Republican',
  'McCotter, Thaddeus G': 'Republican',
  'Huntsman, Jon': 'Republican',
  'Perry, Rick': 'Republican'           
 }
```

#### åŠ è½½æ•°æ®ã€æŸ¥çœ‹æ•°æ®

- `read_csv`

```python
df = pd.read_csv('./data/usa_election.txt')
df.info()
```

```shell
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 536041 entries, 0 to 536040
Data columns (total 16 columns):
 #   Column             Non-Null Count   Dtype  
---  ------             --------------   -----  
 0   cmte_id            536041 non-null  object 
 1   cand_id            536041 non-null  object 
 2   cand_nm            536041 non-null  object 
 3   contbr_nm          536041 non-null  object 
 4   contbr_city        536026 non-null  object 
 5   contbr_st          536040 non-null  object 
 6   contbr_zip         535973 non-null  object 
 7   contbr_employer    525088 non-null  object 
 8   contbr_occupation  530520 non-null  object 
 9   contb_receipt_amt  536041 non-null  float64
 10  contb_receipt_dt   536041 non-null  object 
 11  receipt_desc       8479 non-null    object 
 12  memo_cd            49718 non-null   object 
 13  memo_text          52740 non-null   object 
 14  form_tp            536041 non-null  object 
 15  file_num           536041 non-null  int64  
dtypes: float64(1), int64(1), object(14)
memory usage: 65.4+ MB
```

#### æŒ‡å®šæ•°æ®æˆªå–ï¼Œå°†å¦‚ä¸‹å­—æ®µçš„æ•°æ®è¿›è¡Œæå–ï¼Œå…¶ä»–æ•°æ®èˆå¼ƒ

```python
trimmed_data = df[['cand_nm','contbr_nm','contbr_st','contbr_employer','contbr_occupation','contb_receipt_amt','contb_receipt_dt']]
```

![](http://img.kingtous.cn/img/20200908170718.png)

#### å¯¹æ–°æ•°æ®è¿›è¡Œæ€»è§ˆ,æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç¼ºå¤±æ•°æ®

```python
trimmed_data.isnull().any(axis=0)
```

```shell
cand_nm              False
contbr_nm            False
contbr_st             True
contbr_employer       True
contbr_occupation     True
contb_receipt_amt    False
contb_receipt_dt     False
dtype: bool
```

#### ç”¨ç»Ÿè®¡å­¦æŒ‡æ ‡å¿«é€Ÿæè¿°æ•°å€¼å‹å±æ€§çš„æ¦‚è¦

```python
trimmed_data.describe()
```

![](http://img.kingtous.cn/img/20200908170856.png)

#### ç©ºå€¼å¤„ç†ã€‚å¯èƒ½å› ä¸ºå¿˜è®°å¡«å†™æˆ–è€…ä¿å¯†ç­‰ç­‰åŸå› ï¼Œç›¸å…³å­—æ®µå‡ºç°äº†ç©ºå€¼ï¼Œå°†å…¶å¡«å……ä¸ºNOT PROVIDE

```python
trimmed_data.fillna(value='NOT PROVIDE',inplace=True)
trimmed_data.isnull().any(axis=0)
```

```shell
# ç»“æœ
cand_nm              False
contbr_nm            False
contbr_st            False
contbr_employer      False
contbr_occupation    False
contb_receipt_amt    False
contb_receipt_dt     False
dtype: bool
```

#### å¼‚å¸¸å€¼å¤„ç†ã€‚å°†ææ¬¾é‡‘é¢<=0çš„æ•°æ®åˆ é™¤

```python
trimmed_data = trimmed_data.loc[~(trimmed_data['contb_receipt_amt'] <= 0)]
```

æˆ–è€…`drop`æ‰

```python
dropped_index = trimmed_data.loc[trimmed_data["contb_receipt_amt"] <= 0].index
trimmed_data.drop(labels=dropped_index,axis=0,inplace=True) 
```

![](http://img.kingtous.cn/img/20200908171752.png)

#### ç»Ÿè®¡`party`åˆ—ä¸­å„ä¸ªå…ƒç´ å‡ºç°æ¬¡æ•°

- ä½¿ç”¨value_counts()

```python
trimmed_data['party'].value_counts()
```

```shell
Democrat       289999
Republican     234300
Reform           5313
Libertarian       702
Name: party, dtype: int64
```

#### æŸ¥çœ‹å„ä¸ªå…šæ´¾æ”¶åˆ°çš„æ”¿æ²»çŒ®é‡‘æ€»æ•°`contb_receipt_amt`

```python
trimmed_data.groupby(by='party')['contb_receipt_amt'].sum()
```

```shell
party
Democrat       8.259441e+07
Libertarian    4.132769e+05
Reform         3.429658e+05
Republican     1.251181e+08
Name: contb_receipt_amt, dtype: float64
```

#### æŸ¥çœ‹å…·ä½“æ¯å¤©å„ä¸ªå…šæ´¾æ”¶åˆ°çš„æ”¿æ²»çŒ®é‡‘æ€»æ•°`contb_receipt_amt`

```python
trimmed_data.groupby(by=['contb_receipt_dt','party'])['contb_receipt_amt'].sum()
```

#### å°†è¡¨ä¸­æ—¥æœŸæ ¼å¼è½¬æ¢ä¸º'yyyy-mm-dd'

- ä½¿ç”¨`map`ï¼Œè‡ªå®šä¹‰å¤„ç†å‡½æ•°å³å¯
- ä½¿ç”¨é¢„è®¾é¡¹ä¿å­˜çš„å€¼

```python
# å°†è¡¨ä¸­æ—¥æœŸæ ¼å¼è½¬æ¢ä¸º'yyyy-mm-dd'ã€‚
# 20-JUN-11
def translate(s):
    d = s.split("-")
    d[1] = months[d[1]]
    return "20"+str(d[2])+"-"+str(d[1])+"-"+str(d[0])
trimmed_data["contb_receipt_dt"] = trimmed_data["contb_receipt_dt"].map(translate)
```

![](http://img.kingtous.cn/img/20200908171856.png)

#### æŸ¥çœ‹è€å…µ(æçŒ®è€…èŒä¸š)DISABLED VETERANä¸»è¦æ”¯æŒè°

- è°ğŸ’°è¶Šå¤šå°±æ”¯æŒè°ï¼ˆå¤ªçœŸå®äº†ï¼‰

1. é€‰å‡ºè€å…µ

```python
retired_soidier = trimmed_data.loc[trimmed_data['contbr_occupation'] == 'DISABLED VETERAN']
```

2. åˆ†ç»„èšåˆæé’±æ•°

```python
retired_soidier.groupby(by='cand_nm')['contb_receipt_amt'].sum()
```

```shell
cand_nm
Cain, Herman       300.00
Obama, Barack     4205.00
Paul, Ron         2425.49
Santorum, Rick     250.00
Name: contb_receipt_amt, dtype: float64
```

#### ç»Ÿè®¡è€å…µæèµ ä¸åŒå€™é€‰äººçš„æèµ æ¬¡æ•°

```python
retired_soidier['cand_nm'].value_counts()
```

```shell
Obama, Barack     32
Paul, Ron         22
Cain, Herman       3
Santorum, Rick     3
Name: cand_nm, dtype: int64
```

