---
layout: post
title: æ­å»ºè‡ªå·±çš„ä¸­è½¬gitæœåŠ¡å™¨
subtitle: Crontab+Git
author: Kingtous
date: 2019-04-01 22:03:06
header-img: img/post-bg-halting.jpg
catalog: True
tags:
- Linux
typora-root-url: ../../Kingtous.github.io-master
---

> **èƒŒæ™¯**
>
> æœ‰çš„æ—¶å€™å°†ä¸ªäººåšå®¢pushä¸Šgithubä»“åº“ï¼Œ1-2kb/sçš„é€Ÿåº¦çœ‹ç€è„‘å£³ç–¼ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ
>
> è¦æ˜¯æœ‰ä¸ªè¿æ¥Githubé€Ÿåº¦å¿«çš„äº‘æœåŠ¡å™¨å¸®åŠ©æˆ‘ä»¬æ¨é€åˆ™å°±å¾ˆçˆ½äº†.
>
> å¼€å§‹æ“ä½œï¼

# æ“ä½œæµç¨‹

- åœ¨æœåŠ¡å™¨å»ºç«‹è‡ªå·±çš„ä¸­è½¬gitä»“åº“
- åœ¨æœ¬åœ°å‰¯æœ¬ä¸­é“¾æ¥æˆ‘ä»¬æœåŠ¡å™¨çš„ä¸­è½¬gitä»“åº“
- åœ¨ä¸­è½¬gitä»“åº“é“¾æ¥æˆ‘ä»¬çš„githubä»“åº“
- åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šè®¾ç½®è‡ªåŠ¨æ¨é€ï¼Œè®©Linuxç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ¨é€æˆ‘ä»¬çš„commit
- (å¯é€‰çš„æ‡’äººé¡¹)ç»™æœ¬åœ°é…ç½®æ¨é€è„šæœ¬ï¼Œä¸€æ¡å‘½ä»¤è§£å†³æ¨é€é—®é¢˜

## Step.1 åœ¨æœåŠ¡å™¨å»ºç«‹è‡ªå·±çš„ä¸­è½¬gitä»“åº“

- è®¾ç½®gitè´¦æˆ·ä»¥åŠä»“åº“(ä»¥Ubuntuä¸ºä¾‹)
  - æˆ‘è®¾ç½®çš„è´¦æˆ·åä¸º"git"

```bash
#æ·»åŠ ç”¨æˆ·git
useradd git
#ç»™gitè®¾ç½®å¯†ç 
passwd git
#è®¾ç½®ä¸»ç›®å½•
mkdir /home/git
chown -R /home/git git
#å»ºç«‹ç©ºä»“åº“(ä»“åº“æ–‡ä»¶å¤¹æˆ‘å–åä¸ºmyBlog.git(æ³¨æ„è¿™æ˜¯æ–‡ä»¶å¤¹) (æˆ‘æ˜¯ç”¨æ¥ç®¡ç†åšå®¢çš„))
mkdir /home/git/myBlog.git
cd /home/git/myBlog.git
git --bare init
```

![](/img/unsorted/git_1.png)

- è®©ç”¨æˆ·gitä¿¡ä»»æˆ‘ä»¬æœ¬åœ°ï¼Œæ·»åŠ æˆ‘ä»¬æœ¬åœ°çš„SSHå¯†é’¥
  - å¦‚æœè¿˜æ²¡æœ‰ç”Ÿæˆå¯†é’¥ï¼Œåˆ©ç”¨ssh-keygenç”Ÿæˆ

```bash
su git
mkdir ~/.ssh
touch ~/.ssh/id_rsa.pub
vim ~/.ssh/id_rsa.pub
#ç²˜è´´æˆ‘ä»¬æœ¬åœ°çš„SSHå¯†é’¥è¿›å»ï¼Œä¿å­˜å³å¯
```

## Step.2 åœ¨æœ¬åœ°å‰¯æœ¬ä¸­é“¾æ¥æˆ‘ä»¬æœåŠ¡å™¨çš„ä¸­è½¬gitä»“åº“

- é¦–å…ˆä¿è¯æœ¬åœ°æœ‰ä¸€ä»½å®Œæ•´çš„å‰¯æœ¬(å³ä¸githubç›¸åŒç‰ˆæœ¬çš„æ–‡ä»¶)
- æŠŠè¿™ä»½å‰¯æœ¬ä¼ åˆ°ä¸­è½¬gitä»“åº“ä¸­

```bash
git remote add server git@æœåŠ¡å™¨IP:/home/git/myBlog.git
```

- æ¨é€(æ³¨ï¼šåœ¨æœ¬åœ°ä»“åº“ä¸­æ‰§è¡Œï¼Œä¸æ˜¯æœåŠ¡å™¨ç«¯)

```bash
git push server
#å¦‚æœæç¤ºæ²¡æœ‰è®¾ç½®upstreamï¼Œåˆ™ç”¨ä¸‹é¢çš„å‘½ä»¤
	git push orginæˆ–è€…master server
```

## Step.3 åœ¨ä¸­è½¬gitä»“åº“é“¾æ¥æˆ‘ä»¬çš„githubä»“åº“

- ç»™gitç”¨æˆ·ç”Ÿæˆä¸€ä¸ªSSHå¯†é’¥(ä¹Ÿç”¨ssh-keygen)ï¼Œåœ¨Githubä¸­æ·»åŠ 
- æŠŠè¿™ä»½å‰¯æœ¬ä¼ åˆ°ä¸­è½¬gitä»“åº“ä¸­

```bash
git remote add github (githubæä¾›çš„é“¾æ¥ï¼Œæ³¨æ„æ˜¯SSHé“¾æ¥)
```

- æ¨é€

```bash
git push github master
```

## Step.4 åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šè®¾ç½®è‡ªåŠ¨æ¨é€ï¼Œè®©Linuxç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ¨é€æˆ‘ä»¬çš„commit

- æ–°å»ºä¸Šä¼ è„šæœ¬ï¼Œä¿å­˜(æ ¹æ®ä¸ªäººè®¾ç½®æ›´æ”¹ï¼Œè‡³äºå–åçš„è¯æˆ‘å–åä¸ºupdateBlog.sh)

```bash
cd /home/git/myBlog.git
git push github master
```

- ç»™ä¸Šä¼ è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™

```bash
chmod a+x updateBlog.sh
```

- åˆ©ç”¨Linuxçš„Crontabå‘½ä»¤(æ²¡æœ‰çš„è¯å‘½ä»¤å®‰è£…ä¸€ä¸‹)

```bash
crontab -e
# é€‰æ‹©ç¼–è¾‘å™¨(é€‰æ‹©ä½ è§‰å¾—ç®€å•çš„)
# åŠ å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œ*/2å³ä¸º2å°æ—¶æ¨é€ä¸€æ¬¡ï¼Œä½¿ç”¨å‘½ä»¤è¡Œbashæ‰§è¡ŒupdateBlog.shè„šæœ¬
# è¯¦ç»†é…ç½®è¯·ç™¾åº¦Crontabå‘½ä»¤å‚æ•°è®¾ç½®
0 */2 * * * bash /home/git/script/updateBlog.sh
```

## Step.5 (å¯é€‰çš„æ‡’äººé¡¹)ç»™æœ¬åœ°é…ç½®æ¨é€è„šæœ¬ï¼Œä¸€æ¡å‘½ä»¤è§£å†³æ¨é€é—®é¢˜

- ç¼–å†™è‡ªåŠ¨ä¸Šä¼ è„šæœ¬(æˆ‘ä¿å­˜çš„æ–‡ä»¶åä¸ºupdateBlogUsingServer.sh)

```bash
#åŠ å…¥pushæ—¶é—´çš„æ”¯æŒ
time=$(date "+%Y-%m-%d-%H:%M:%S")
#è¿›å…¥ä»“åº“æ ¹ç›®å½•
cd /Users/kingtous/Kingtous.github.io-master
#æ·»åŠ æ›´æ”¹(åˆ é™¤çš„è¯éœ€è¦é€šè¿‡ git rm xxx)
git add *
#commitæ›´æ”¹
git commit -m "Update At "$time
#å‘ä¸­è½¬æœåŠ¡å™¨pushæ›´æ”¹
git push server
```

- èµ‹äºˆæ‰§è¡Œæƒé™

```bash
chmod a+x updateBlogUsingServer.sh
```



è‡³æ­¤å…¨éƒ¨é…ç½®å®Œæˆï¼Œä¸‹æ¬¡æˆ‘ä»¬å¯¹ä»“åº“åšå®Œæ›´æ”¹åï¼Œç›´æ¥æ‰§è¡ŒupdateBlogUsingServer.shæˆ–è€…git push serverï¼Œæ¨é€ä¸Šæˆ‘ä»¬çš„æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨å°±å¯ä»¥è‡ªåŠ¨åœ¨æŒ‡å®šçš„æ—¶é—´å‘¨æœŸå†…å‘Githubæ¨é€æˆ‘ä»¬çš„æ›´æ”¹ï¼Œå²‚ä¸ç¾å“‰ï¼Ÿ(æ¯”å¦‚è¿™ç¯‡åšå®¢å°±æ˜¯è‡ªåŠ¨æ¨é€çš„ï¼ˆğŸ˜ï¼‰)

